# q_bulk_delete
A Project to do parallel tree deletes on Qumulo

This goal of this project is to automate runnign Qumulo tree delete jobs on a tree.  The main script takes a path, finds the directories under that path, then starts up a tree delete job on each of the top-level subdirectories of the given path.  The idea is to get parallel tree delete jobs running to increase the speed of a very wide tree.  By default it follows the recommendation of no more than 10 tree delete jobs per node, but that value can be changed by the user.  In addition, I included a utlitiy script to act as a front end to the tree delete APIs for simplicity purposes.  It allows the user to list running tree delete jobs, abort tree delete jobs, and start new tree delete jobs.  The usage of the script is below

<PRE>
Usage q_bulk_delete.py [-hDr] [-c creds] [-t token] [-f token_file] [-j jobs] [-i interval] qumulo:path
-h | --help : Display usage help
-D | --DEBUG : Generate debug data
-r | --delete-root : Delete the root path specified on the command line when finished.
-c | --creds : Specify cluster credentials [user:password]
-t | --token : Specify access token
-f | --token-file : Specify access token file
-j | --jobs: Specify maximium jobs per node [def: 10]
-i | --interval : Specify wait time between output lines in seconds [def: 30]
qumulo : Name or IP of a Qumulo node
path : Starting path for tree deletes


Usage: treedel.py [-hDT] [-c creds] [-t token] [-f token-file] qumulo cmd [args]
-h | --help : Print usage message
-D | --DEBUG : Generate debug information
-T | --TEST : Test mode.  Used with 'start' command.  Only show what delete jobs would be run
-c | --creds : Specify cluster credentials [user:password]
-t | --token : Specify access token
-f | --token-file : Specify access token file
qumulo : Name of IP of a qumulo node
cmd : Specify a command.  Supported commands are 'list', 'abort', 'start'
args:	list  : Optionally specify a path or regular expression to dispaly.  [def: show all jobs]
	abort : Specify a comma separated list of paths to abort or use 'all' to abort all jobs
	start : Specify a comma separated list of paths to start a tree delete job
</PRE>

Authentication

Qumulo API calls need the user to be authenticated.  These scripts provide multiple ways to achieve this

- The user can be prompted to enter a user and password (password will not be shown on the screen)
- The user can specify a user and password on the command line with -c flag
- The user can specify an access token with the -t flag
- The user can specify a credentials file that contains an access token.  By default the script will use .qfsd_cred which is generated by the Qumulo CLI (qq) command.

Minimum Privledges

The minimum privledges to run these scripts are:

- FS_ATTRIBUTES_READ
- FS_TREE_DELETE_READ
- FS_TREE_DELETE_WRITE
- NETWORK_READ

